<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Loup et les 7 Chevreaux â€“ Conte interactif</title>
    <link rel="stylesheet" href="style.css">
    <!-- Ajout de Vue.js via CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        <!-- ----- Conteneur principal (chargement) ----- -->
        <div id="book-container" v-if="isLoaded">
            <div class="text-bg-fixed"></div>

            <!-- ----- Barre de progression ----- -->
            <div id="progress-bar">
                <div id="progress" :style="{ width: progressWidth + '%' }"></div>
            </div>

            <!-- ----- Instructions mini-jeux (sous la barre) ----- -->
            <div
              v-if="(currentScene.interactive && currentScene.chevreaux) || (currentScene.caillouxGame && currentScene.cailloux)"
              class="mini-game_instructions"
              aria-hidden="false"
            >
              <p v-if="currentScene.interactive && currentScene.chevreaux">
                Trouve les deux chevreaux cachÃ©s dans l'image pour passer Ã  la prochaine scÃ¨ne !
              </p>
              <p v-else-if="currentScene.caillouxGame && currentScene.cailloux">
                Aide les chevreaux Ã  glisser les cailloux dans le ventre du loup pour s'Ã©chapper !
              </p>
            </div>

            <!-- ----- ScÃ¨ne (image + interactions) ----- -->
            <div class="scene">
                <div class="image-container">
                    <transition name="page" mode="out-in">
                        <img 
                            :src="currentScene.img" 
                            :alt="'ScÃ¨ne ' + (currentIndex + 1)" 
                            :key="currentIndex"
                        >
                    </transition>

                    <!-- Jeu des cailloux (prÃ©sent uniquement si la scÃ¨ne le demande) -->
                    <div v-if="currentScene.caillouxGame && currentScene.cailloux" class="cailloux-game">
                      <div
                        class="loup-ventre-dropzone"
                        @dragover.prevent
                        @drop="dropCaillou"
                      >
                        <span v-if="caillouxInVentre.length === 0"></span>
                        <svg v-for="c in caillouxInVentre" :key="c.id" class="caillou-svg" viewBox="0 0 32 32" aria-hidden="true">
                          <ellipse cx="16" cy="16" rx="13" ry="8" fill="#b7b7b7" stroke="#888" stroke-width="2"/>
                        </svg>
                      </div>

                      <div class="cailloux-list" aria-hidden="false">
                        <div
                          v-for="c in caillouxRestants"
                          :key="c.id"
                          class="draggable-caillou"
                          draggable="true"
                          @dragstart="startDragCaillou(c, $event)"
                          @touchstart.prevent="startTouchCaillou(c)"
                        >
                          <svg class="caillou-svg" viewBox="0 0 32 32" aria-hidden="true" focusable="false">
                            <ellipse cx="16" cy="16" rx="13" ry="8" fill="#b7b7b7" stroke="#888" stroke-width="2"/>
                          </svg>
                        </div>
                      </div>
                    </div>

                    <!-- Chevreaux interactifs (si prÃ©sents) -->
                    <div v-if="currentScene.interactive && currentScene.chevreaux">
                        <div
                            v-for="(ch, idx) in currentScene.chevreaux"
                            :key="idx"
                            class="chevreau-spot"
                            :style="{ left: ch.x, top: ch.y }"
                            @click="findChevreau(idx)"
                            :class="{ found: foundChevreaux.includes(idx) }"
                        ></div>
                    </div>
                </div>

                <!-- ----- Texte narratif (boÃ®te fixe en bas) ----- -->
                <div class="text-box">
                    <p :key="currentIndex">{{ displayedText }}</p>
                </div>
            </div>

            <!-- ----- Musique et contrÃ´le ----- -->
            <audio ref="bgMusic" src="assets/audio/intro.mp3" loop></audio>
            <button class="music-btn" @click="toggleMusic">
                {{ isPlaying ? 'ðŸ”ˆ Stop' : 'ðŸ”Š Musique' }}
            </button>
        </div>

        <!-- Ã‰cran de chargement -->
        <div v-else class="loading">
            Chargement du conte...
        </div>

        <!-- ----- Boutons de navigation fixes ----- -->
        <button class="nav nav-left" @click="previousScene" :disabled="currentIndex === 0">â—€</button>
        <button class="nav nav-right" @click="nextScene" :disabled="(!canGoNext) || currentIndex === scenes.length - 1">â–¶</button>

    </div>

    <script type="module">
        import { app } from './app.js'
        const { createApp } = Vue
        createApp(app).mount('#app')
    </script>
</body>
</html>
